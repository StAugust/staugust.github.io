# iptables简介

iptables/ip6tables用于管理IPv4/IPv6包过滤和NAT(Network Address Translation, 网络地址转换). 
iptables包含若干表，用于配置包的过滤规则，每个表又可以包含若干的内置chains和用户自定义的chains. 
每个chain又包含若干的规则(rules), rules用于匹配网络packets, 并为匹配到的packets指定下一步的操作，又称为"目标"(target). 
一条规则(rule)指定如何匹配packets以及将匹配到的packets的传递给目标(target). 
如果一个packet不匹配当前chain中当前rule, 则会传递给下一条rule. 如果匹配, 则由当前rule指定的target来决定对当前packet的操作, 比如说传递给另外一条chain, iptables-extensions中描述的target, 或者指定的值(`ACCEPT`, `DROP`, `RETURN`). 

+ ACCEPT 允许packet通过
+ DROP   拒绝packet
+ RETURN 停止遍历当前chain, 返回到之前的调用此chain的chain的下一条rule, 如果到了内置chain的终点或者匹配到内置chain中target为RETURN的rule, 则由调用此chain的chain的policy决定此包的命运. 

iptables 目前有5张独立的表(就是iptables -t的参数):
+ filter: 这个是默认的表，包含内置的chain, 包含`INPUT`(packets destinated to local sockets), `FORWARD`(packets being routed through the box), `OUTPUT`(for locally-generated packets)
+ nat: 当创建新连接时, 遍历此table, 默认有三个chain: 
  - `PREROUTING` for altering packets as soon as they came in 
  - `OUTPUT` for altering locally generated packets before routing
  - `POSTROUTING` for altering packets as they are about to go out
+ mangle: 此表用于定制packet alteration. 2.4.17之前内置`PREROUTING`(for altering incoming packets before routing), `OUTPUT`(for altering locally generated packets before routing), 自kernel 2.4.18开始, 新增三个内置rule, 
  - `INPUT` for packets coming into the box itself
  - `FORWARD` for altering packets being routed through the box 
  - `POSTROUTING` for altering packets as they are about to go out
+ raw: 包含`PREROUTING`(for packets arriving via any network interface), `OUTPUT`(for packets generated by local processes), 用于避免connection tracking(和target `NOTRACK`一起使用)
+ security: 用于MAC(Mandatory Access Control)的rules, 以及被target为`SECMARK`, `CONNSECMARK`激活的. 含以下三个内建chain: 
  - `INPUT` for packets coming into the box itself 
  - `OUTPUT` for altering locally-generated packets before routing
  - `FORWARD` for altering packets being routed through the box


